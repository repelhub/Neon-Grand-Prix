<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Neon Grand Prix</title>
<style>
  body {
    margin: 0;
    background: #02030a;
    color: #ffffff;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  canvas {
    display: block;
    margin: 0 auto;
    background: #000000;
  }

  /* HUD */
  #hud {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    max-width: 900px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #00f7ff;
    text-shadow: 0 0 8px #00f7ff;
    font-size: 14px;
    pointer-events: none;
  }

  #hud .block {
    pointer-events: auto;
  }

  .bar-container {
    width: 180px;
    height: 12px;
    border-radius: 8px;
    border: 1px solid #00f7ff;
    overflow: hidden;
    background: #020617;
  }

  .bar-fill {
    height: 100%;
    width: 0%;
    transition: width 0.1s linear;
  }

  #speedBarFill {
    background: linear-gradient(90deg, #00ff88, #ffcc00, #ff0044);
  }

  #nitroBarFill {
    background: linear-gradient(90deg, #00f7ff, #aa00ff);
  }

  /* Car selection menu */
  #carMenuOverlay {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at top, #05152a 0, #01010a 60%, #000000 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }

  #carMenu {
    width: 80%;
    max-width: 800px;
    background: rgba(2, 8, 23, 0.95);
    border-radius: 16px;
    border: 2px solid #00f7ff;
    box-shadow: 0 0 32px #00f7ff88;
    padding: 20px;
    color: #e5e7eb;
  }

  #carMenu h1 {
    margin-top: 0;
    text-align: center;
    color: #00f7ff;
    text-shadow: 0 0 12px #00f7ff;
  }

  #carList {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
    gap: 12px;
    margin-top: 10px;
  }

  .carCard {
    background: #020617;
    border-radius: 10px;
    border: 1px solid #1f2937;
    padding: 10px;
    cursor: pointer;
    transition: 0.2s;
    position: relative;
  }

  .carCard:hover {
    border-color: #00f7ff;
    box-shadow: 0 0 12px #00f7ff77;
    transform: translateY(-3px);
  }

  .carCard.selected {
    border-color: #22c55e;
    box-shadow: 0 0 16px #22c55eaa;
  }

  .carName {
    font-weight: bold;
    color: #e5e7eb;
  }

  .carPrice {
    font-size: 12px;
    color: #9ca3af;
  }

  .carStats {
    margin-top: 4px;
    font-size: 11px;
    color: #a5b4fc;
  }

  .carOwned {
    position: absolute;
    top: 6px;
    right: 8px;
    font-size: 11px;
    color: #22c55e;
  }

  #carMenuFooter {
    margin-top: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
  }

  #startRaceBtn {
    padding: 8px 16px;
    border-radius: 999px;
    border: none;
    background: linear-gradient(90deg, #22c55e, #4ade80);
    color: #022c22;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 16px #22c55eaa;
  }

  #startRaceBtn:disabled {
    opacity: 0.4;
    cursor: default;
    box-shadow: none;
  }

  #message {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(15,23,42,0.9);
    border-radius: 999px;
    padding: 6px 14px;
    color: #e5e7eb;
    font-size: 12px;
    border: 1px solid #00f7ff55;
    display: none;
  }

  #hint {
    position: fixed;
    bottom: 10px;
    right: 10px;
    font-size: 11px;
    color: #9ca3af;
  }
</style>
</head>
<body>

<canvas id="game" width="900" height="600"></canvas>

<div id="hud">
  <div class="block">
    <div>Car: <span id="hudCarName">Street Starter</span></div>
    <div>Cash: $<span id="hudCash">0</span></div>
    <div>Lap: <span id="hudLap">1</span>/3</div>
  </div>
  <div class="block">
    <div>Speed</div>
    <div class="bar-container"><div id="speedBarFill" class="bar-fill"></div></div>
  </div>
  <div class="block">
    <div>Nitrous (SHIFT)</div>
    <div class="bar-container"><div id="nitroBarFill" class="bar-fill"></div></div>
  </div>
</div>

<div id="carMenuOverlay">
  <div id="carMenu">
    <h1>Neon Grand Prix</h1>
    <p>Select your car. Better cars earn more cash per win.</p>
    <div id="carList"></div>
    <div id="carMenuFooter">
      <div>
        Cash: $<span id="menuCash">0</span><br/>
        <span style="font-size:11px;color:#9ca3af;">Click a car to buy/select. Win races to earn more.</span>
      </div>
      <button id="startRaceBtn" disabled>Start Race</button>
    </div>
  </div>
</div>

<div id="message"></div>
<div id="hint">Arrow keys to steer, UP to accelerate, DOWN to brake, SHIFT for nitrous</div>

<script>
  // =======================
  // GAME DATA
  // =======================
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  const W = canvas.width;
  const H = canvas.height;

  // Horizon images (you can replace with real assets)
  const horizonStormy = "#020617";
  const horizonAfternoon = "#0f172a";
  let currentHorizon = "stormy";

  function setHorizon(type) {
    currentHorizon = type;
  }

  // Car definitions
  const cars = [
    { name: "Street Starter", price: 0, multiplier: 1.0, accel: 0.12, topSpeed: 5.5, handling: 1.0 },
    { name: "Neon Sprint", price: 25000, multiplier: 1.2, accel: 0.13, topSpeed: 6.0, handling: 1.05 },
    { name: "Night Viper", price: 80000, multiplier: 1.5, accel: 0.15, topSpeed: 6.7, handling: 1.1 },
    { name: "Night Phantom", price: 250000, multiplier: 2.0, accel: 0.17, topSpeed: 7.3, handling: 1.15 },
    { name: "Solar Striker", price: 500000, multiplier: 2.5, accel: 0.18, topSpeed: 7.8, handling: 1.2 },
    { name: "Quantum Racer", price: 1000000, multiplier: 3.0, accel: 0.2, topSpeed: 8.3, handling: 1.25 }
  ];

  let ownedCars = [true, false, false, false, false, false];
  let currentCarIndex = 0;
  let currentCar = cars[0];

  // Player state
  let playerMoney = 0;
  let speed = 0;
  let baseMaxSpeed = 6.0;
  let acceleration = 0.12;
  let decel = 0.08;
  let friction = 0.02;
  let nitroAmount = 100;
  let nitroMax = 100;
  let nitroActive = false;
  let nitroCooldown = false;
  let lap = 1;
  let maxLaps = 3;

  // Input
  const keys = {
    ArrowLeft: false,
    ArrowRight: false,
    ArrowUp: false,
    ArrowDown: false,
    ShiftLeft: false,
    ShiftRight: false
  };

  // Road / pseudo 3D
  const segmentCount = 200;
  let roadOffset = 0;
  let laneOffset = 0;
  let curve = 0;

  // HUD references
  const hudCarName = document.getElementById("hudCarName");
  const hudCash = document.getElementById("hudCash");
  const hudLap = document.getElementById("hudLap");
  const speedBarFill = document.getElementById("speedBarFill");
  const nitroBarFill = document.getElementById("nitroBarFill");
  const msgBox = document.getElementById("message");

  // Menu references
  const carMenuOverlay = document.getElementById("carMenuOverlay");
  const carListEl = document.getElementById("carList");
  const menuCashEl = document.getElementById("menuCash");
  const startRaceBtn = document.getElementById("startRaceBtn");

  // =======================
  // INIT CAR MENU
  // =======================
  function refreshCarMenu() {
    menuCashEl.textContent = playerMoney.toLocaleString();
    carListEl.innerHTML = "";

    cars.forEach((car, index) => {
      const card = document.createElement("div");
      card.className = "carCard";
      if (index === currentCarIndex) {
        card.classList.add("selected");
      }

      const name = document.createElement("div");
      name.className = "carName";
      name.textContent = car.name;
      card.appendChild(name);

      const price = document.createElement("div");
      price.className = "carPrice";
      price.textContent = car.price === 0 ? "Free" : "$" + car.price.toLocaleString();
      card.appendChild(price);

      const stats = document.createElement("div");
      stats.className = "carStats";
      stats.innerHTML =
        "Earnings x" + car.multiplier.toFixed(1) +
        "<br/>Accel: " + car.accel.toFixed(2) +
        " | Top: " + car.topSpeed.toFixed(1);
      card.appendChild(stats);

      if (ownedCars[index]) {
        const ownedTag = document.createElement("div");
        ownedTag.className = "carOwned";
        ownedTag.textContent = "OWNED";
        card.appendChild(ownedTag);
      }

      card.addEventListener("click", () => {
        if (!ownedCars[index]) {
          if (playerMoney >= car.price) {
            playerMoney -= car.price;
            ownedCars[index] = true;
            showMessage("Purchased " + car.name + "!");
          } else {
            showMessage("Not enough cash!");
            return;
          }
        }
        currentCarIndex = index;
        currentCar = cars[index];
        updateCarStatsFromSelection();
        refreshCarMenu();
        updateHUD();
        startRaceBtn.disabled = false;
      });

      carListEl.appendChild(card);
    });

    // Enable start button if at least one car owned (always true but just to be safe)
    startRaceBtn.disabled = !ownedCars.some(v => v);
  }

  function updateCarStatsFromSelection() {
    acceleration = currentCar.accel;
    baseMaxSpeed = currentCar.topSpeed;
  }

  startRaceBtn.addEventListener("click", () => {
    carMenuOverlay.style.display = "none";
    resetRace();
  });

  function showMessage(text) {
    msgBox.textContent = text;
    msgBox.style.display = "block";
    setTimeout(() => {
      msgBox.style.display = "none";
    }, 2000);
  }

  // =======================
  // INPUT HANDLERS
  // =======================
  window.addEventListener("keydown", (e) => {
    if (e.code in keys) {
      keys[e.code] = true;
    }
    if (e.code === "ShiftLeft" || e.code === "ShiftRight") {
      activateNitro();
    }
  });

  window.addEventListener("keyup", (e) => {
    if (e.code in keys) {
      keys[e.code] = false;
    }
  });

  // =======================
  // GAME LOOP
  // =======================
  function resetRace() {
    speed = 0;
    nitroAmount = nitroMax;
    lap = 1;
    roadOffset = 0;
    laneOffset = 0;
    curve = 0;
    setHorizon("stormy");
    updateHUD();
  }

  function updateHUD() {
    hudCarName.textContent = currentCar.name;
    hudCash.textContent = playerMoney.toLocaleString();
    hudLap.textContent = lap;
  }

  function activateNitro() {
    if (!nitroCooldown && nitroAmount > 0 && speed > 1) {
      nitroActive = true;
      nitroCooldown = true;
      showMessage("Nitrous engaged!");
      setTimeout(() => {
        nitroActive = false;
      }, 1500);
      setTimeout(() => {
        nitroCooldown = false;
      }, 3000);
    }
  }

  function update() {
    // Steering / speed
    if (keys.ArrowUp) {
      speed += acceleration;
    } else {
      speed -= friction;
    }

    if (keys.ArrowDown) {
      speed -= decel;
    }

    if (speed < 0) speed = 0;

    let maxSpeed = baseMaxSpeed;
    if (nitroActive && nitroAmount > 0) {
      maxSpeed += 1.8;
      nitroAmount -= 0.7;
      if (nitroAmount < 0) nitroAmount = 0;
    } else {
      nitroAmount += 0.15;
      if (nitroAmount > nitroMax) nitroAmount = nitroMax;
    }

    if (speed > maxSpeed) speed = maxSpeed;

    if (keys.ArrowLeft) {
      laneOffset -= 0.05 * currentCar.handling;
    }
    if (keys.ArrowRight) {
      laneOffset += 0.05 * currentCar.handling;
    }

    // Keep lane offset within road bounds
    if (laneOffset < -1.5) laneOffset = -1.5;
    if (laneOffset > 1.5) laneOffset = 1.5;

    // Road scrolling
    roadOffset += speed * 0.15;
    if (roadOffset > segmentCount) {
      roadOffset -= segmentCount;
      lap++;
      if (lap > maxLaps) {
        finishRace();
      } else {
        updateHUD();
        if (lap === 2) setHorizon("afternoon");
      }
    }

    // Update bars
    const speedPercent = (speed / (baseMaxSpeed + 2)) * 100;
    speedBarFill.style.width = Math.min(100, speedPercent).toFixed(1) + "%";
    nitroBarFill.style.width = (nitroAmount / nitroMax * 100).toFixed(1) + "%";
  }

  function finishRace() {
    const baseReward = 500;
    const reward = Math.round(baseReward * currentCar.multiplier * (1 + Math.random() * 0.3));
    playerMoney += reward;
    showMessage("Race finished! Earned $" + reward.toLocaleString());
    updateHUD();
    carMenuOverlay.style.display = "flex";
    refreshCarMenu();
  }

  // =======================
  // RENDERING (PSEUDO 3D)
  // =======================
  function draw() {
    // background horizon
    if (currentHorizon === "stormy") {
      const grd = ctx.createLinearGradient(0, 0, 0, H * 0.4);
      grd.addColorStop(0, "#020617");
      grd.addColorStop(1, "#0b1120");
      ctx.fillStyle = grd;
    } else {
      const grd = ctx.createLinearGradient(0, 0, 0, H * 0.4);
      grd.addColorStop(0, "#3b82f6");
      grd.addColorStop(1, "#0f172a");
      ctx.fillStyle = grd;
    }
    ctx.fillRect(0, 0, W, H * 0.5);

    if (currentHorizon === "afternoon") {
      // simple skyline blocks
      ctx.fillStyle = "#020617";
      for (let i = 0; i < 12; i++) {
        const bw = 30 + Math.random() * 40;
        const bh = 40 + Math.random() * 80;
        const bx = Math.random() * W;
        const by = H * 0.5 - bh;
        ctx.fillRect(bx, by, bw, bh);
      }
    }

    // ground
    ctx.fillStyle = "#020617";
    ctx.fillRect(0, H * 0.5, W, H * 0.5);

    // road segments
    const roadWBase = W * 0.5;
    const laneCount = 3;
    const perspective = H * 0.5;

    for (let i = 0; i < segmentCount; i++) {
      const z = (i + roadOffset) % segmentCount;
      const depth = z / segmentCount;

      const roadWidth = roadWBase * (1 - depth * 0.7);
      const midX = W / 2 + laneOffset * 120 * (1 - depth);

      const y = H * 0.5 + depth * perspective;

      // alternating stripes on road
      ctx.fillStyle = i % 2 === 0 ? "#111827" : "#020617";
      ctx.beginPath();
      ctx.moveTo(midX - roadWidth, y);
      ctx.lineTo(midX + roadWidth, y);
      ctx.lineTo(midX + roadWidth * 1.02, y + perspective / segmentCount + 2);
      ctx.lineTo(midX - roadWidth * 1.02, y + perspective / segmentCount + 2);
      ctx.closePath();
      ctx.fill();

      // lane lines
      ctx.strokeStyle = "#374151";
      ctx.lineWidth = 1;
      for (let l = 1; l < laneCount; l++) {
        const laneX = midX - roadWidth + (roadWidth * 2 * l) / laneCount;
        ctx.beginPath();
        ctx.moveTo(laneX, y);
        ctx.lineTo(laneX, y + perspective / segmentCount + 2);
        ctx.stroke();
      }
    }

    // player car (simple neon rectangle)
    const carY = H * 0.8;
    const carW = 40;
    const carH = 70;
    const carX = W / 2 - carW / 2 + laneOffset * 60;

    // glow
    ctx.shadowColor = "#22c55e";
    ctx.shadowBlur = 20;
    ctx.fillStyle = "#16a34a";
    ctx.fillRect(carX, carY, carW, carH);
    ctx.shadowBlur = 0;

    // windows / details
    ctx.fillStyle = "#0f172a";
    ctx.fillRect(carX + 6, carY + 8, carW - 12, carH / 3);

    ctx.fillStyle = "#22c55e";
    ctx.fillRect(carX + 4, carY + carH - 6, carW - 8, 4);

    // nitro glow under car
    if (nitroActive) {
      const grad = ctx.createRadialGradient(
        carX + carW / 2, carY + carH, 5,
        carX + carW / 2, carY + carH + 20, 40
      );
      grad.addColorStop(0, "#00f7ff99");
      grad.addColorStop(1, "transparent");
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.ellipse(carX + carW / 2, carY + carH + 15, 40, 15, 0, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }

  // =======================
  // START
  // =======================
  updateCarStatsFromSelection();
  updateHUD();
  refreshCarMenu();
  loop();
</script>
</body>
</html>
